# Семантический анализ

Семантический анализ происходит во время разбора синтаксиса.
В методах разбора соответствующих правил БНФ происходит:
1. проверка соответствия типов,
2. легальность разыменования поля записи,
3. проверка, определён ли идентификатор при его использовании
4. проверка отсутствия переопределения идентификатора.

Для поддержки семантического анализа существует
[отдельный модуль](../../src/semantics),
в котором определены необходимые типы данных, которые
в различных комбинациях находятся в аргументах и результатах
методов разбора БНФ.

К этим типам относятся перечисление `Identifier` для хранения
информации об идентификаторе,

```rust
pub enum Identifier {
    Variable(String, Type),
    Type(Type),
    Unknown
}
```

перечисление `Type` для хранения информации о типе данных

```rust
pub enum Type {
    Record(FieldTable),
    Scalar(Enumeration),
    Integer,
    Real,
    Char,
    Unknown
}
```

и структура Scope для хранения набора
идентификаторов в некоторой области видимости
с сохранением информации об идентификаторах
в объемлющей области видимости.

```rust
pub struct Scope {
    outer_scope: Option<Box<Scope>>,
    identifiers: Identifiers,
}
```

Тип `Identifiers` определён как `HashMap<String, Identifier>`.

## Дублирование ошибок

Для того чтобы избежать дублирования ошибок вида неопределённый идентификатор,
при первом появлении некоторого неопределённого идентификатора, он заносится
в текущую область видимости со значением типа `Type::Unknown`.
Таким образом при последующем появлении данного идентификатора, он уже
будет иметься в памяти компилятора, поэтому ошибка о неопределённом
идентификаторе выведена не будет.

## Тестирование

Тесты для семантического анализатора описаны в конце файла
[code.rs](../../src/parsing/code.rs).
